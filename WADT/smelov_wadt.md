07.02.24
Основные принципы зацементированы протоколом хттп
Хттп определяет архитектуру веб-приложений
ОПРЕДЕЛЕНИЕ (опять самодурит) **Интернет - 4 компоненты**
  - стек тцп/ип (в первую очередь интернет - это сеть, в которой используется стек тцп/ип)
    - Все разработчики когда-то договорились, что стек тцп/ип будет включаться в их операционные системы
  - службы интернет (днс, мыло, фтп, телнет, www, ...) - сервер + протокол доступа к этому серверу (важная особенность - порт, ею прослушиваемый (первые ~1024 портов зарезервированы для служб интернета))
    - не надо путать хост интернета с хост-процессом или приложением из разработки серверов
    - разработка веб-приложения - это разработка службы интернет (www)
  - набор организций, обеспечивающих работу интернета (головная - ISOC (Internet Society), занимается развитием сети, остальные так или иначе ассоциированы с ней)
    - IETF (Internet Engineering Task Force) - инженерная группа, проектирующая интернет. Выпускает документацию всего, что работает в интернете (RFC (Request for comments). Если помечен как STD, то он больш не будет меняться). Её деятельность тоже описана в RFC 4677
    - IAB (Internet Architecture Board) - совет по архитектуре интернета, одна из комиссий IETF
    - ICANN (Internet Corporation for Assigned Names and Numbers) - управляет доменными именами и айпишниками. Торгуют доменными именами. Она поддерживает сервера, отвечающие за корневые доменные имена
    - IANA (Internet Assigned Numbers Authority) - поддерживают и регистрируют типы данных, принятых в интернете (MIME (Multipurpose Inernet Mail Extensions)). Любой контент в интернете идентифицируется в MIME (заголовоки типа Accept-Type)
    - W3C (WWW Consortium) - разрабатывает и отдаёт в IETF для стандартизации (хттп, хтмл, цсс, юрл, пнг)
  - Документация (RFC)
**ЗНАТЬ КАК СВОЮ БИОГРАФИЮ ^^^**
Консорциум - это некоммерческая организация, существующая для согласования стандартов, общественной деятельности. Юникод - тоже консорциум
**Интернет-ресурс - всё что имеет адрес в интернете (служба тоже ресурс)**
**Программирование в интернет - разработка распределённого приложения, предоставляющего >=1 связанных между собой ресурсов**. Частные случаи: сайт, облако
Технологии программирования в интернет (все кроссплатформенные)
  - LAMP (linux, apache, mysql, php/perl) древняя, но до сих пор работает
  - Java EE
    - application server - сервера, описанные в документации Java EE (tomcat, glassfish, ...)
  - ASP.NET
  - Node.JS
  - Ruby on Rails
  - Django
Для связи между компонентами как правило используются протоколы WebSocket, WebDav, SMTP, POP3, IMAP

## Основы веб-программирования
%определение веб-приложения%
Могут быть разные формы взаимодействия между клиентом и сервером
  - один клиент, один сервер
  - один клиент, несколько серверов
  - несколько клиентов, один сервер
  - несколько клиентов, сервер общается с другим сервером (первый сервер - клиент по отношению ко второму)
TCP, WebSocket - дуплексные (можно рассматривать как два противонаправленных симплексных канала)
**Свойства ХТТП ТОЖЕ ЗНАТЬ КАК БИОГРАФИЮ**
  - асимметричный (сообщения от клиента к серверу и наоборот отличаются: запросы и ответы)
  - полудуплексный канал (в каждый момент времени сообщение может передвигаться либо в одну сторону, либо в другую)
  - версии
    - 1.1
      - действующий
      - текстовый
    - 2
      - черновой
      - бинарный
  - два типа абонентов
    - клиент
    - сервер
  - на один запрос - один ответ, иначе ошибка и наоборот
  - TCP-порты 80, 443
  - для адресации URI/URN
  - поддерживается W3C, описан в нескольких RFC
**Запрос ТОЖЕ ЗНАТЬ**
  - метод
    - options
    - get
    - put
    - post
    - head
    - delete
    - trace
    - connect
    - какой-то неизвестный extension-method
  - URI
  - версия
  - заголовки (пары имя: значение) нужны для управления соединением
    - описанные в протоколе ХТТП (**ЗНАТЬ ПО ДВА ЗАГОЛОВКА КАЖДОГО ТИПА**)
      - general (в запросах и ответах)
        - Cache-Control
        - Pragma
        - ...
      - request
        - Accept
        - Accept-Charset/Encoding/Language
        - Range (какие части ресурса должен вернуть сервер)
        - ...
      - response
        - Age (сколько объект пробыл в прокси-кэше)
        - Retry-After (сколько клиент должен ждать перед повторным запросом)
        - ...
      - Entity для сущности в запросах и ответах
        - Contrnt-Type/Range/MD5/...
        - ...
    - кастомные заголовки
  - параметры (пары имя: значение) могут передаваться несколькими способами
    - если гет, передаётся как часть URI
    - если форма, то в теле запроса
  - расширение/тело (одно и то же) (в гет его нет совсем)
**Ответ (угадай, что с ним надо сделать)**
  - версия
  - код
  - пояснение к коду
  - заголовки
  - тело
Параметров в нём нет
**Коды состояния**
  - 1xx - информационные
  - 2xx - успешные
  - 3xx - редирект
  - 4xx - ошибка клиента
  - 5xx - ошибка сервера

14.02.24
Вроде как от URL отказались, теперь это называется URI (Смелов не помнит источник, но раз надо, значит, надо)
URL описывает множество URI, содержит местонахождение ресурса и протокол
Протокол STD66 (устоявшийся RFC, железобетонный) описывает URI
**Веб-браузер - один из видов HTTP-клиентов**. Превратились в операционные системы. Характеризуется
  - DOM
  - BOM (API с **localStorage, sessionStorage, history, window, navigator, ...** - объекты, свойственные браузеру. Отдельно стоит объект XmlHttpRequest, позволяющий выполнять асинхронные запросы)
  - CSS
  - JS (Какой стандарт EcmaScript поддерживает)
  - HTML5 и его API (canvas, work, media, geolocation, filesystem, ...)
  - поддерживаемые протоколы HTTP
!!**DOM -  модель представления браузером HTML-страницы + API**. Браузер парсит страницу в объекты и предоставляет API для доступ а к этой древовидной структуре (не только для жабаскрипта, но я для прочих языков. document - объект браузера, а не языка). Представлен на сайте W3C  
Когда браузер обрабатывает страницу, он добавляет сначала скрипт объявления таких объектов, как document  
У браузеров есть движки
  - js
  - html
  - ...
Веб-серверы: IIS, Apache, Glassfish, Tomcat, nginx

## Общие принципы разработки веб-приложений
Самая простая схема веб-приложения:
![Самая простая схема веб-приложения](Самая_простая_схема_веб-приложения.png)
При поступлении запроса мидлваре создаёт объекты запроса и ответа
Обычно ресурс создаётся для обработки запроса и уничтожается. Для каждого клиента в таком случае создаётся свой ресурс. Это делается потому, что предполагается, что таких запросов может быть очень много, и если их не уничтожать, то система быстро ляжет. Такая система не хранит состояния.
Проверить то, что HTTP не хранит состояния, можн оследующим образом: установить запросом переменную программного объекта и посмотреть вторым запросом, установилась ли она. Если не установилась, то для каждого запроса создаётся новый программный объект
Есть RFC, регламентирующий сохранение состояния на строне сервера
На сеансовом уровне OSI происходит шифрование, на этом уровне необходимо сохранение состояния
Объект сессии описывает соединение на сеансовом уровне
TCP должен помнить своё состояние, чтобы гарантировать правильную очерёдность доставки пакетов (у каждого пакета свой номер) (в отличие от UDP)
В веб-приложениях для хранения состояния используется специальный **программный объект** (у которого есть id - обычно 128bit число - и **который соответствует серии запросов**). У любой сессии есть начало и конец (первый и последний запрос). Они определяются следующим образом:
  - есть параметр session timeout (определяет максимальный интервал между запросами в рамках одной сессии. При превышении этого интервала сессия разрушается, и при следующем запросе начинается новая (обычно 20-30 минут))
  - для определения начала серии запросов используется специальный механизм HTTP - куки (сервер смотрит на запрос: если есть куки с session id, то не первый, иначе первый )
    - куки - фрагмент данных "ключ - значение", который может быть запомнен на стороне клиента по указанию сервера (заголовок Set-Cookie). Есть параметр path: шаблон URI: браузер запоминает куки по этому наблону. Если path не указан, то вместо него используется uri, с которго был получен ответ с заголовком Set-Cookie. После установки куки каждый запрос на заданный URI обязан содержать заголовок Cookie с установленными куками (в которых может содержаться session id)
Сессия:  
![сессия](сессия.png)  
Обычно сервер в свойства ответа записывает идентификатор сессии или делает ссылку на объект сессии  
Сессия - одно из хранилищ, в котором можно сохранять данные (в запрос писать данные тоже можно, но они сохраняются всего на один запрос)  
Кончилась ли сессия, определяется по Session Timeout, время скользящее, при каждом запросе продлевается  
Куки - метод сохранения состояния на стороне клиента  

21.02.2024  
Два объекта веб-приложения:
- запрос
- ответ
Обычно у сессии есть хранилище  
В REST API рекомендуется хранение состояния на стороне клиента, потому что при балансировке нагрузки на разные сервера данные клиента на сервере могут не сохраниться  
Контекст приложения - резидентный объект - предназначен для хранения информации о веб-приложениb (в том числе сервере), хранится в конфигах  
Резидентные объекты создаются при старте сервера  
Хранилище может быть реализовано по-разному, но обычно - это объект process (в nodejs)  
Программистам доступно 3 хранилища:
- request (самое маленькое и недолгоиграющеее)
- session (для хранения информации между запросами)
- контекст (между сессиями)
Есть механизмы, позволяющие записывать данные в конфиги, чтобы при старте сервер получал пользовательскую информацию  
**Персистентность** - способность сохранять состояние (условно говоря, на другом носителе). Обычно это контекст, но в некоторых системах ещё и сессии  
Фильтр/мидлваре - конвейер обработки запроса и ответа. Любой из элементов конвейера может самостоятельно ответить на запрос и не пустить его дальше  
Фильтр - объект, реализующий некий интерфейс  
Сначала создаётся приложение, в которое затем дописываются цепочки фильтров  
В некоторых системах может быть несколько цепочек фильтров (например, по одной на каждый URI)  
Listeners - специальные серверные объекты, предназначенные для обработки событий на стороне сервера (запуск и остановка сервера и т.д.)  
Можно создать резидентный объект при помощи обработчика на старт сервера, передавая ссылку на объект всем обработчикам запросов, и пока сервер будет работать, этот объект будет жить в памяти  

*Кеш (се(р)верный)*  
Кеширование - перемещение данных из медленной памяти в быструю  
Кешировтаь будем ответы  
Есть кеш-менеджер
- приходит запрос, он его обрабатывает
- запрос обрабатывается обработчиком
- на обратном пути по конвейеру кеш-менеджер запоминает ответ в кеше (в простейшем случае - по URI)
В некоторых кешах поддерживается не только абсолютное время, но и скользящее (время между запросами)  
В нормальных системах ключи составные, могут содержать все параметры строки запроса и т.д.  
